<!DOCTYPE html>
<html>
<head>
  <title>Claude Chrome Parallel - Test Page</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #1a1a2e;
      color: #eee;
    }
    h1 { color: #a855f7; }
    .card {
      background: #16213e;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    input, button {
      padding: 10px 16px;
      margin: 5px;
      border-radius: 6px;
      border: 1px solid #444;
      background: #0f3460;
      color: #fff;
    }
    button {
      background: #a855f7;
      border: none;
      cursor: pointer;
    }
    button:hover { background: #9333ea; }
    #log {
      background: #0a0a0f;
      padding: 15px;
      border-radius: 6px;
      font-family: monospace;
      white-space: pre-wrap;
      max-height: 400px;
      overflow-y: auto;
    }
    .success { color: #22c55e; }
    .error { color: #ef4444; }
    .info { color: #60a5fa; }
  </style>
</head>
<body>
  <h1>ğŸ”Œ Claude Chrome Parallel - Test Page</h1>

  <div class="card">
    <h3>1. Extension ID ì…ë ¥</h3>
    <input type="text" id="extensionId" placeholder="abcdefghijklmnop..." style="width: 300px">
    <button onclick="saveExtensionId()">ì €ì¥</button>
  </div>

  <div class="card">
    <h3>2. ì—°ê²° í…ŒìŠ¤íŠ¸</h3>
    <button onclick="testConnection()">Extension ì—°ê²° í…ŒìŠ¤íŠ¸</button>
    <button onclick="testInitialize()">MCP Initialize</button>
    <button onclick="listTools()">ë„êµ¬ ëª©ë¡ ë³´ê¸°</button>
  </div>

  <div class="card">
    <h3>3. ì„¸ì…˜ í…ŒìŠ¤íŠ¸</h3>
    <input type="text" id="sessionName" placeholder="ì„¸ì…˜ ì´ë¦„ (ì˜ˆ: test-session-1)" style="width: 250px">
    <button onclick="createSession()">ì„¸ì…˜ ìƒì„±</button>
    <button onclick="listSessions()">ì„¸ì…˜ ëª©ë¡</button>
  </div>

  <div class="card">
    <h3>4. íƒ­ í…ŒìŠ¤íŠ¸</h3>
    <button onclick="getTabContext()">íƒ­ ì»¨í…ìŠ¤íŠ¸</button>
    <button onclick="createTab()">ìƒˆ íƒ­ ìƒì„±</button>
  </div>

  <div class="card">
    <h3>ë¡œê·¸</h3>
    <button onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
    <div id="log"></div>
  </div>

  <script>
    let extensionId = localStorage.getItem('extensionId') || '';
    let currentSessionId = null;
    let requestId = 1;

    document.getElementById('extensionId').value = extensionId;

    function log(message, type = 'info') {
      const logEl = document.getElementById('log');
      const time = new Date().toLocaleTimeString();
      const className = type;
      logEl.innerHTML += `<span class="${className}">[${time}] ${message}</span>\n`;
      logEl.scrollTop = logEl.scrollHeight;
    }

    function clearLog() {
      document.getElementById('log').innerHTML = '';
    }

    function saveExtensionId() {
      extensionId = document.getElementById('extensionId').value.trim();
      localStorage.setItem('extensionId', extensionId);
      log('Extension ID ì €ì¥ë¨: ' + extensionId, 'success');
    }

    async function sendToExtension(method, params = {}) {
      if (!extensionId) {
        log('Extension IDë¥¼ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”!', 'error');
        return null;
      }

      const request = {
        jsonrpc: '2.0',
        id: requestId++,
        method: method,
        params: params
      };

      log(`â†’ ${method}: ${JSON.stringify(params)}`, 'info');

      return new Promise((resolve, reject) => {
        try {
          chrome.runtime.sendMessage(
            extensionId,
            { type: 'mcp-request', request: request },
            (response) => {
              if (chrome.runtime.lastError) {
                log(`âœ— Error: ${chrome.runtime.lastError.message}`, 'error');
                reject(chrome.runtime.lastError);
              } else {
                log(`â† ${JSON.stringify(response, null, 2)}`, 'success');
                resolve(response);
              }
            }
          );
        } catch (e) {
          log(`âœ— Exception: ${e.message}`, 'error');
          reject(e);
        }
      });
    }

    async function testConnection() {
      log('ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
      try {
        const response = await sendToExtension('initialize', {
          protocolVersion: '2024-11-05',
          capabilities: {}
        });
        if (response) {
          log('âœ“ ì—°ê²° ì„±ê³µ!', 'success');
        }
      } catch (e) {
        log(`âœ— ì—°ê²° ì‹¤íŒ¨: ${e.message}`, 'error');
      }
    }

    async function testInitialize() {
      await sendToExtension('initialize', {
        protocolVersion: '2024-11-05',
        capabilities: {}
      });
    }

    async function listTools() {
      await sendToExtension('tools/list', {});
    }

    async function createSession() {
      const name = document.getElementById('sessionName').value || `session-${Date.now()}`;
      currentSessionId = name;
      await sendToExtension('sessions/create', {
        sessionId: name,
        name: name
      });
    }

    async function listSessions() {
      await sendToExtension('sessions/list', {});
    }

    async function getTabContext() {
      if (!currentSessionId) {
        log('ë¨¼ì € ì„¸ì…˜ì„ ìƒì„±í•˜ì„¸ìš”', 'error');
        return;
      }
      await sendToExtension('tools/call', {
        name: 'tabs_context_mcp',
        arguments: { sessionId: currentSessionId }
      });
    }

    async function createTab() {
      if (!currentSessionId) {
        log('ë¨¼ì € ì„¸ì…˜ì„ ìƒì„±í•˜ì„¸ìš”', 'error');
        return;
      }
      await sendToExtension('tools/call', {
        name: 'tabs_create_mcp',
        arguments: { sessionId: currentSessionId }
      });
    }

    log('í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œë¨. Extension IDë¥¼ ì…ë ¥í•˜ê³  ì—°ê²° í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ì„¸ìš”.', 'info');
  </script>
</body>
</html>
